

services:
  youtube-proxy:
    build: ./proxy
    container_name: aquatiq-youtube-proxy
    restart: always
    env_file:
      - .env
    volumes:
      - ./youtube-cookies.txt:/app/youtube-cookies.txt
    shm_size: '2gb'
    networks:
      - aquatiq-local

  ntp-server:
    image: cturra/ntp
    container_name: aquatiq-ntp
    restart: always
    environment:
      - NTP_SERVERS=0.no.pool.ntp.org,1.no.pool.ntp.org
      - LOG_LEVEL=0
    ports:
      - "123:123/udp"
    networks:
      - aquatiq-local

  signage-server:
    build: ./signage-server
    container_name: aquatiq-signage-server
    restart: always
    env_file:
      - .env
      - signage-server/.env
    environment:
      - POSTGRES_HOST=postgres
      - POSTGRES_PORT=5432
      - POSTGRES_DB=${POSTGRES_DB:-aquatiq_signage}
      - POSTGRES_USER=${POSTGRES_USER:-aquatiq}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-postgres}
      - VIDEOS_DIR=/app/videos
      - NODE_ENV=${NODE_ENV:-production}
    volumes:
      - signage-videos:/app/videos
      - ./signage-server/src:/app/src
    ports:
      - "127.0.0.1:3002:3002"
    networks:
      - aquatiq-local

  screenshot-server:
    build: ./screenshot-server
    container_name: aquatiq-screenshot-server
    restart: always
    env_file:
      - screenshot-server/.env
    volumes:
      - screenshot-storage:/app/screenshots
    shm_size: '2gb'
    networks:
      - aquatiq-local

  

networks:
  aquatiq-local:
    external: true

volumes:
  signage-videos:
    driver: local
  screenshot-storage:
    driver: local
